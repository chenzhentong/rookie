<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>消息通知</title>
    <link rel="stylesheet" type="text/css" href="css/mainBody.css"/>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="css/header.css"/>
    <link rel="stylesheet" type="text/css" href="css/footer.css"/>
</head>
<body>
<div class="headpage"></div>
<div class="mainBody">
    <div class="table-responsive">
        <table class="table" id="table1">
            <caption>寄件记录
                <span id="sentPackagesSize"></span></caption>
            <thead id="thead1">
            <tr>
                <th>寄件时间</th>
                <th>到达时间</th>
                <th>取件时间</th>
                <th>寄件地址</th>
                <th>收件地址</th>
                <th>发送人</th>
                <th>接收人</th>
                <th>投递人</th>
                <th>物品名称</th>
                <th>重量/kg</th>
                <th>运费/元</th>
                <th>状态</th>
                <th>物流信息</th>
            </tr>
            </thead>
            <tbody id="tbody1">
            </tbody>
        </table>
    </div>
    <div class="table-responsive">
        <table class="table" id="table2">
            <caption>取件记录
                <span id="receivedPackagesSize"></span></caption>
            <thead id="thead2">
            <tr>
                <th>寄件时间</th>
                <th>到达时间</th>
                <th>取件时间</th>
                <th>寄件地址</th>
                <th>收件地址</th>
                <th>发送人</th>
                <th>接收人</th>
                <th>投递人</th>
                <th>物品名称</th>
                <th>重量/kg</th>
                <th>运费/元</th>
                <th>物流信息</th>
            </tr>
            </thead>
            <tbody id="tbody2">

            </tbody>
        </table>
    </div>
    <div class="modal fade" id="logisticsModal" tabindex="-1" role="dialog" aria-labelledby="myLogisticsModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">×
                    </button>
                    <h4 class="modal-title" id="myLogisticsModalLabel">
                        物流信息
                    </h4>
                </div>
                <div class="modal-body">
                    <table class="table" id="table3">
                        <caption><span id="sentPackagesSize3"></span></caption>
                        <thead id="thead3">
                        <tr>
                            <th>创建时间</th>
                            <th>更新时间</th>
                            <th>消息</th>
                            <th>包裹号</th>
                        </tr>
                        </thead>
                        <tbody id="tbody3">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="footpage"></div>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript">
    $(".headpage").load("header.html");
    $(".footpage").load("footer.html");
</script>
<script>

    $.ajax({
        url: "/package/search",
        method: 'get',
        headers: {"Content-Type": "application/json"},
        success: function (obj, status) {
            console.log(obj)
            console.log(obj.data)
            if (obj.code == 200) {
                var items = obj.data
                console.log(items)
                if (obj.data.length == 0) {
                    alert("未查询到相关的包裹信息")
                }
                items.forEach(function (item, index) {
                    var state = ""
                    var sendDate = ""
                    var arriveDate = ""
                    var takeDate = ""
                    switch (item.state) {
                        case 0:
                            state = "揽收中"
                            sendDate = item.sendDate
                            break;
                        case 1:
                            state = "运输中"
                            sendDate = item.sendDate
                            break;
                        case 2:
                            state = "待取件"
                            sendDate = item.sendDate
                            arriveDate = item.arriveDate
                            break;
                        case 3:
                            state = "已签收"
                            sendDate = item.sendDate
                            arriveDate = item.arriveDate
                            takeDate = item.takeDate
                            break;
                        default:
                            state = ""
                            break;
                    }
                    $("#tbody1").append("<tr>" +
                        "<td>" + sendDate + "</td><td>"
                        + arriveDate + "</td> <td>"
                        + takeDate + "</td> <td>"
                        + item.sendAddress.name + "</td> <td>"
                        + item.deliveryAddress.name + "</td> <td>"
                        + item.sender.name + "</td> <td>"
                        + item.receiver.name + "</td> <td>"
                        + item.deliver.name + "</td> <td>"
                        + item.ordersDetail.goods.name + "</td> <td>"
                        + item.ordersDetail.goods.weight + "</td><td>"
                        + item.freight + "</td><td>"
                        + state + "</td><td><button type=\"button\" class=\"btn btn-primary\" " +
                        "data-toggle=\"modal\" data-target=\"#logisticsModal\"" +
                        "onclick='getLogistics(" + JSON.stringify(item.logisticsList) + ")'>查看物流</button></td>" +
                        "</tr>"
                    )
                })
                $('#searchedPackagesSize').html(obj.data.length + "条")
            } else {
                alert(obj.message)
                location.href = "login.html"
            }
        },
        error: function (response) {
            alert(response.status);
        }
    })
</script>
<script>
    function getLogistics(logisticsList) {
        var tbody3 = document.getElementById('tbody3')
        document.getElementById('sentPackagesSize3').innerText = "  当前包裹有" + logisticsList.length + "条物流消息"
        while (tbody3.hasChildNodes()) //当div下还存在子节点时 循环继续
        {
            tbody3.removeChild(tbody3.firstChild);
        }
        logisticsList.forEach(function (item, index) {
            $('#tbody3').append("<tr><td>"
                + item.createDate + "</td> <td>"
                + item.updateDate + "</td> <td>"
                + item.message + "</td> <td>"
                + item.packageId + "</td></tr>")
        })

    }
</script>
</body>
</html>
